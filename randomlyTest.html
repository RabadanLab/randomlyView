<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/11.1.0/nouislider.css"></script>
    <style>
      #chart {
        position: fixed;
        left: 0px;
        right: 0px;
        top: 0px;
        bottom: 0px;
        z-index: -1;
        background-color: white;
      }
      #menu {
        position: fixed;
        left: 20px;
        top: 20px;
        z-index: 1;
        border: 1px black;
        border-radius: 5px;
        background-color: white;
      }
      .slider {
        width: 300px;
        margin-left: 10px;
      }
      body {
        font-family: sans-serif
      }
    </style>
  </head>
  <body>
    <div id="chart"></div>
    <div id="menu">
      <div>
        Perplexity: <span id="perpVal"></span>
      </div>
      <br>
      <div class="slider" id="perpSlider"></div>
      <br>
      <div>
        lambda range: <span id="lambda1Val"></span> - <span id="lambda2Val"></span>
      </div>
      <br>
      <div class="slider" id="lambdaSlider"></div>
    </div>
    <script>
      var perpValue = document.getElementById("perpVal")
      var perpSlider = document.getElementById("perpSlider");
      noUiSlider.create(perpSlider, {
      	start: [10],
      	connect: true,
      	range: {
      		'min': 10,
      		'max': 30
      	},
        step: 20
      });

      var lambda1Value = document.getElementById("lambda1Val")
      var lambda2Value = document.getElementById("lambda2Val")
      var lambdaSlider = document.getElementById("lambdaSlider")
      noUiSlider.create(lambdaSlider, {
      	start: [0, 28],
      	connect: true,
      	range: {
      		'min': 0,
      		'max': 28
      	},
        step: 1,
        margin: 1
      });

      var chartDiv = document.getElementById("chart");
      var strokeWidth = 1;
      var margin = {top: 10, right: 10, bottom: 10, left: 10}
      var width = chartDiv.clientWidth - margin.left - margin.right ;
      var height = chartDiv.clientHeight - margin.top - margin.bottom - 50;
      /*
      width = 960 - margin.left - margin.right,
      height = 700 - margin.top - margin.bottom;
      */
      var x = d3.scaleLinear().range([0, width - margin.right]).domain([-100,100]);
      var y = d3.scaleLinear().range([0, height]).domain([100,-100]);

      /*
      function randomCoords(length, max) {
          return Array.apply(null, Array(length)).map(function(item, index){
            return {x: Math.floor(Math.random() * max),
              y:Math.floor(Math.random() * max)};
        });
      }
      */
      var svg = d3.select("body").append("svg")
        .attr("width", width + margin.right + margin.left - 20)
        .attr("height", height + margin.top + margin.bottom )
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

      function update(data){
        var elem = svg.selectAll("circle")
            .data(data)

        elem.attr("class", "update")
        .transition()
        .duration(750)
          .attr("cx", function(d) { return x(d[0]); })
          .attr("cy", function(d) { return y(d[1]); })

        elem.enter().append("circle")
          .attr("r", "1.5px")
          .attr("fill","dodgerblue")
          .attr("cx", function(d) { return x(d[0]); })
          .attr("cy", function(d) { return y(d[1]); })

      }

      var perplexity = 10;
      var lambda_1 = 0; //0-27
      var lambda_2 = 28; //1-28
      //initial load
      perpValue.innerHTML = perplexity;
      lambda1Value.innerHTML = lambda_1;
      lambda2Value.innerHTML = lambda_2;
      d3.text("Pos/mouse_cortex_" + lambda_1 + "_" + lambda_2 + "_" + perplexity + ".txt", function(error,text){
        if (error) throw error;
        // var coords = randomCoords(500,1000)
        var data = d3.tsvParseRows(text)
        update(data)
      });



      perpSlider.noUiSlider.on('update', function(){
        perplexity = Math.trunc(perpSlider.noUiSlider.get())
        perpValue.innerHTML = perplexity;
        d3.text("Pos/mouse_cortex_" + lambda_1 + "_" + lambda_2 + "_" + perplexity + ".txt", function(error,text){
          if (error) throw error;
          // var coords = randomCoords(500,1000)
          var data = d3.tsvParseRows(text)
          update(data)
        });
      });

      lambdaSlider.noUiSlider.on('update', function(){
        lambda_1 = Math.trunc(lambdaSlider.noUiSlider.get()[0])
        lambda_2 = Math.trunc(lambdaSlider.noUiSlider.get()[1])
        lambda1Value.innerHTML = lambda_1;
        lambda2Value.innerHTML = lambda_2;
        d3.text("Pos/mouse_cortex_" + lambda_1 + "_" + lambda_2 + "_" + perplexity + ".txt", function(error,text){
          if (error) throw error;
          // var coords = randomCoords(500,1000)
          var data = d3.tsvParseRows(text)
          update(data)
        });
      });

    </script>
  </body>
</html>
